---
title: 'Race, Gender Disparities in Public Works'
author: "Jamison R. Crawford, MPA"
date: "January 24, 2019"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 4
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '4'
---

<style>
body {
text-align: justify}
</style>

```{r packages, echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}

options(scipen = 999)

if(!require(zoo)){install.packages("zoo")}
if(!require(tidyr)){install.packages("tidyr")}
if(!require(readr)){install.packages("readr")}
if(!require(dplyr)){install.packages("dplyr")}
if(!require(GGally)){install.packages("GGally")}
if(!require(scales)){install.packages("scales")}
if(!require(stringr)){install.packages("stringr")}
if(!require(ggplot2)){install.packages("ggplot2")}
if(!require(kableExtra)){install.packages("kableExtra")}

library(zoo)
library(tidyr)
library(readr)
library(dplyr)
library(GGally)
library(scales)
library(stringr)
library(ggplot2)
library(kableExtra)

rm(list = ls())

```

# Introduction

The following work analyzes four public construction projects in the Greater Syracuse area, including:

* [Empire Expo Center](https://en.wikipedia.org/wiki/Empire_Expo_Center)
* [Highway I-690](https://en.wikipedia.org/wiki/Interstate_690)
* [Lakeview Amphitheater](https://en.wikipedia.org/wiki/Lakeview_Amphitheater) 
* [Hancock International Airport](https://en.wikipedia.org/wiki/Syracuse_Hancock_International_Airport)

These records were procured by *Legal Services of Central New York* via the [Freedom of Information Act](https://en.wikipedia.org/wiki/Freedom_of_Information_Act_(United_States)).

All records are scraped, cleaned, and stored, including scripts and code books, in their respective Github repositories. The entire analysis, from raw data to the present publication, may be reproduced exactly with these resources - respectively, [Expo](https://github.com/jamisoncrawford/expo), [690](https://github.com/jamisoncrawford/690), [Lakeview](https://github.com/jamisoncrawford/lakeview), and [Hancock](https://github.com/jamisoncrawford/hancock). Analysis and publication scripts are stored in the [REIS](https://github.com/jamisoncrawford/reis) repository.

<br>

# Workforce Demographics

```{r loading, echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}

names <- c("all_gross_race", "all_gross_sex",   "all_gross_sxrc", 
           "all_hours_race", "all_hours_sex",   "all_hours_sxrc", 
           "all_races",      "all_sexes",       "all_sxrc", 
           "expo_sex_class", "expo_race_class", "expo_rcsx_class")

files <- paste0(names, ".csv")
url <- "https://raw.githubusercontent.com/jamisoncrawford/reis/master/Datasets/"
urls <- paste0(url, files)

for (i in 1:length(names)){
  assign(names[i], read_csv(urls[i]))
}

rm(files, i, names, url, urls)

```

```{r all_sex, echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}

tbl_all_sex <- all_sexes %>%
  select(sex:project) %>%
  rename("Gender" = sex, "Count" = count, "Percent" = percent, "Project" = project) %>%
  arrange(Project, desc(Gender), Percent)

viz_all_sex <- tbl_all_sex
tbl_all_sex <- tbl_all_sex %>%
  filter(Project != "Expo Center") %>%
  select(-Project) %>%
  mutate(Percent = percent(Percent, accuracy = 0.01))

```

<br>

## Demographic Overview

```{r sex, echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}

sex <- all_sexes %>%
  as_data_frame() %>%
  filter(project != "Expo Center") %>%
  group_by(sex) %>%
  summarize(total = sum(count)) %>%
  as_data_frame() %>%
  mutate(percent = total / sum(total)) %>%
  rename("Gender" = sex, 
         "Total" = total, 
         "Percent" = percent)

tbl_sex <- sex %>%
  arrange(desc(Total)) %>%
  mutate(Percent = percent(Percent, accuracy = 0.01))

race <- all_races %>%
  as_data_frame() %>%
  filter(project != "Expo Center") %>%
  group_by(race) %>%
  summarize(total = sum(count)) %>%
  as_data_frame() %>%
  mutate(percent = total / sum(total)) %>%
  rename("Race" = race, "Total" = total, "Percent" = percent)

tbl_race <- race %>%
  arrange(desc(Total)) %>%
  mutate(Percent = percent(Percent, accuracy = 0.01))

sxrc <- all_sxrc %>%
  as_data_frame() %>%
  filter(project != "Expo Center") %>%
  group_by(sex, race) %>%
  summarize(total = sum(count)) %>%
  as_data_frame() %>%
  mutate(percent = total / sum(total)) %>%
  rename("Gender" = sex, "Race" = race, "Total" = total, "Percent" = percent)

tbl_sxrc <- sxrc %>%
  arrange(desc(Total)) %>%
  mutate(Percent = percent(Percent, accuracy = 0.01))
  
```

**Note****:** Due to the high aggregation of records on the "Exposition Center", it is impossible to determine unique workers. Therefore, "Expo Center" records are excluded from *Section 2: Workforce Demographics*. 

<br>

<center>

**Table 1: Workforce Gender Distribution**

```{r tbl_sex, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

kable(tbl_sex) %>%
  kable_styling(bootstrap_options = c("striped", 
                                      "hover", 
                                      "responsive"),
                font_size = 14,
                full_width = TRUE)

```

</center>

<br>

<center>

**Image 1: Workforce Gender Distribution**

```{r sex_dist_viz, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(sex, aes(x = Gender, y = Percent)) +
  coord_flip() +
  geom_bar(stat = "identity", fill = "skyblue") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent)

```

</center>

<center>

**Table 2: Workforce Race Distribution**

```{r tbl_race, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

kable(tbl_race) %>%
  kable_styling(bootstrap_options = c("striped", 
                                      "hover", 
                                      "responsive"),
                font_size = 14,
                full_width = TRUE)

```

</center>

<br>

<center>

**Image 2: Workforce Race Distribution**

```{r race_dist_viz, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(race, aes(x = reorder(Race, Total), y = Percent)) +
  coord_flip() +
  geom_bar(stat = "identity", fill = "skyblue") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent) +
  xlab("Race")

```

</center>

<br>

<center>

**Table 3: Workforce Gender & Race Distribution**

```{r tbl_sxrc, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

kable(tbl_sxrc) %>%
  kable_styling(bootstrap_options = c("striped", 
                                      "hover", 
                                      "responsive"),
                font_size = 14,
                full_width = TRUE)

```

</center>

<br>

<center>

**Image 3: Workforce Distribution by Gender & Race**

```{r sxrc_dist, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(sxrc, aes(x = reorder(Race, Total), y = Percent, fill = Gender)) +
  coord_flip() +
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent) +
  xlab("Race")

```

</center>

<br>

## Worker Gender by Project

<br>

<center>

**Table 4: Gender Distribution for All Projects**

```{r all_sex_tbl, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

kable(tbl_all_sex) %>%
  kable_styling(bootstrap_options = c("striped", 
                                      "hover", 
                                      "responsive"),
                font_size = 14,
                full_width = TRUE) %>%
  group_rows(group_label = "Hancock International", start_row = 1, end_row = 2) %>%
  group_rows(group_label = "Highway I-690", start_row = 3, end_row = 4) %>%
  group_rows(group_label = "Lakeview Amphitheater", start_row = 5, end_row = 6)

```

</center>

<br>

<center>

**Image 4: Gender Distribution for All Projects**

```{r all_sex_dist_viz, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

viz_all_sex <- viz_all_sex %>%
  filter(Project != "Expo Center") %>%
  arrange(Project, desc(Gender))

ggplot(viz_all_sex, aes(x = Project, y = Percent, fill = Gender)) +
  coord_flip() +
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent)

```

</center>

<br>

<center>

**Image 5: Gender Totals by Project**

```{r all_sex_count_viz, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(viz_all_sex, aes(x = Project, y = Count, fill = Gender)) +
  coord_flip() +
  geom_bar(stat = "identity", position = "dodge") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::number_format(big.mark = ","))

```

</center>

<br>

## Worker Race by Project

```{r all_race, echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}

tbl_all_race <- all_races %>%
  select(race:project) %>%
  filter(project != "Expo Center") %>%
  rename("Race" = race, "Count" = count, "Percent" = percent, "Project" = project) %>%
  arrange(Project, desc(Percent))

viz_all_race <- tbl_all_race
tbl_all_race <- tbl_all_race %>% 
  select(-Project) %>%
  mutate(Percent = percent(Percent, accuracy = 0.01))

```

</center>

<br>

<center>

**Table 5: Race Distribution for All Projects**

```{r all_race_tbl, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

kable(tbl_all_race) %>%
  kable_styling(bootstrap_options = c("striped", 
                                      "hover", 
                                      "responsive"),
                font_size = 14,
                full_width = TRUE) %>%
  group_rows(group_label = "Hancock International", start_row = 1, end_row = 5) %>%
  group_rows(group_label = "Highway I-690", start_row = 6, end_row = 9) %>%
  group_rows(group_label = "Lakeview Amphitheater", start_row = 10, end_row = 14)

```

</center>

<br>

<center>

**Image 6: Race Distribution by Project**

```{r all_race_dist_viz, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(viz_all_race, aes(x = Project, y = Percent, fill = reorder(Race, Percent))) +
  coord_flip() +
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent) +
  theme(legend.title = element_text("Race")) +
  labs(fill = "Race")

```

</center>

<br>

<center>

**Image 7: Race Totals by Project**

```{r all_race_count_viz, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(viz_all_race, aes(x = reorder(Project, Count), y = Count, fill = reorder(Race, Count))) +
  coord_flip() +
  geom_bar(stat = "identity", position = "dodge") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::number_format(big.mark = ",")) +
  xlab("Project") +
  labs(fill = "Race")

```

</center>

<br>

## Race & Gender by Project

```{r all_sxrc, echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}

tbl_all_sxrc <- all_sxrc %>%
  select(sex:project, -total) %>%
  filter(project != "Expo Center") %>%
  rename("Gender" = sex, "Race" = race, "Count" = count, "Percent" = percent, "Project" = project) %>%
  arrange(Project, desc(Percent))

viz_all_sxrc <- tbl_all_sxrc
tbl_all_sxrc <- tbl_all_sxrc %>% 
  select(-Project) %>%
  mutate(Percent = percent(Percent, accuracy = 0.01))

```

</center>

<br>

<center>

**Table 6: Race & Gender Distribution for All Projects**

```{r all_sxrc_tbl, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

kable(tbl_all_sxrc) %>%
  kable_styling(bootstrap_options = c("striped", 
                                      "hover", 
                                      "responsive"),
                font_size = 14,
                full_width = TRUE) %>%
  group_rows(group_label = "Hancock International", start_row = 1, end_row = 5) %>%
  group_rows(group_label = "Highway I-690", start_row = 6, end_row = 11) %>%
  group_rows(group_label = "Lakeview Amphitheater", start_row = 12, end_row = 19)

```

</center>

<br>

<center>

**Image 8: Race & Gender Distribution for All Projects**

```{r all_sxrc_dist_viz, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(viz_all_sxrc, aes(x = Gender, y = Percent, fill = Race)) +
  coord_flip() +
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent) +
  labs(fill = "Race") +
  facet_grid(Project ~ . )

```

</center>

<br>

<center>

**Image 9: Race & Gender Totals by Project**

```{r all_sxrc_count_viz, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(viz_all_sxrc, aes(x = Gender, y = Count, fill = Race)) +
  coord_flip() +
  geom_bar(stat = "identity", position = "dodge") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::number_format(big.mark = ",")) +
  xlab("Gender") +
  facet_grid(Project ~ . )

```

</center>

<br>

# Workforce Hourage

**Note****:** Though unique worker count is indeterminable per "Expo Center" records. However, the proportion of hours and gross pay by gender and race are available. Therefore, "Expo Center" records will now be included until otherwise stated.

```{r all_hours_sex, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

hrs_sx <- all_hours_sex %>%
  select(-total) %>%
  rename("Gender" = sex, "Count" = count, "Percent" = percent, "Project" = project)

hrs_rc <- all_hours_race %>%
  select(-total) %>%
  rename("Race" = race, "Count" = count, "Percent" = percent, "Project" = project)
  
hrs_sxrc <- all_hours_sxrc %>%
  select(-total) %>%
  rename("Gender" = sex, "Race" = race, "Count" = count, "Percent" = percent, "Project" = project)

hrs_sxrc[1:6, "Project"] <- "Hancock"

hrs_sx_wf <- hrs_sx %>%
  group_by(Gender) %>%
  summarize(Total = sum(Count)) %>%
  as_data_frame() %>%
  mutate(Percent = Total / sum(Total)) %>%
  arrange(desc(Percent))

hrs_rc_wf <- hrs_rc %>%
  group_by(Race) %>%
  summarize(Total = sum(Count)) %>%
  as_data_frame() %>%
  mutate(Percent = Total / sum(Total)) %>%
  arrange(desc(Percent))

hrs_sxrc_wf <- hrs_sxrc %>%
  group_by(Gender, Race) %>%
  summarize(Total = sum(Count)) %>%
  as_data_frame() %>%
  mutate(Percent = Total / sum(Total)) %>%
  filter(!is.na(Race),
         Total > 0.0) %>%
  arrange(desc(Percent))

```

<br>

## Hourage Overview 

<center>

**Table 7: Hourage Distribution by Gender, All Projects**

```{r hrs_sx_wf_tbl, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

hrs_sx_wf_tbl <- hrs_sx_wf %>%
  mutate(Percent = percent(Percent, accuracy = 0.01),
         Total = number(Total, big.mark = ","))

kable(hrs_sx_wf_tbl) %>%
  kable_styling(bootstrap_options = c("striped", 
                                      "hover", 
                                      "responsive"),
                font_size = 14,
                full_width = TRUE)

```

</center>

<br>

<center>

**Image 10: Workforce Hourage Distribution by Gender**

```{r hrs_sx_wf_viz, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(hrs_sx_wf, aes(x = Gender, y = Percent)) +
  coord_flip() +
  geom_bar(stat = "identity", fill = "skyblue") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent)

```

</center>

<br>

<center>

**Table 8: Workforce Hourage Distribution by Race, All Projects**

```{r hrs_rc_wf_tbl, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

hrs_rc_wf_tbl <- hrs_rc_wf %>%
  mutate(Percent = percent(Percent, accuracy = 0.01),
         Total = number(Total, big.mark = ",", accuracy = 2))

kable(hrs_rc_wf_tbl) %>%
  kable_styling(bootstrap_options = c("striped", 
                                      "hover", 
                                      "responsive"),
                font_size = 14,
                full_width = TRUE)

```

</center>

<br>

<center>

**Image 11: Workforce Hourage Distribution by Race**

```{r hrs_rc_wf_viz, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(hrs_rc_wf, aes(x = reorder(Race, Total), y = Percent)) +
  coord_flip() +
  geom_bar(stat = "identity", fill = "skyblue") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent) +
  xlab("Race")

```

</center>

<br>

<center>

**Table 9: Workforce Hourage Distribution by Gender & Race, All Projects**

```{r hrs_sxrc_wf_tbl, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

hrs_sxrc_wf_tbl <- hrs_sxrc_wf %>%
  mutate(Percent = percent(Percent, accuracy = 0.01),
         Total = number(Total, big.mark = ",", accuracy = 2))

kable(hrs_sxrc_wf_tbl) %>%
  kable_styling(bootstrap_options = c("striped", 
                                      "hover", 
                                      "responsive"),
                font_size = 14,
                full_width = TRUE)

```

</center>

<br>

<center>

**Image 12: Workforce Hourage Distribution by Gender & Race**

```{r sxrc_hrs_dist_viz, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(hrs_sxrc_wf, aes(x = reorder(Race, Total), y = Percent, fill = Gender)) +
  coord_flip() +
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent) +
  xlab("Race")

```

</center>

<br>

## Hourage by Gender & Project

```{r sex_hourage_setup, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

hrs_rc <- all_hours_race %>%
  select(-total) %>%
  rename("Race" = race, "Count" = count, "Percent" = percent, "Project" = project)

hrs_sx <- hrs_sx %>% arrange(Project, desc(Count), Gender)
hrs_rc <- hrs_rc %>% arrange(Project, desc(Count), Race)
hrs_sxrc <- hrs_sxrc %>% arrange(Project, desc(Count), Gender, Race)

hrs_sx_viz <- hrs_sx
hrs_rc_viz <- hrs_rc
hrs_sxrc_viz <- hrs_sxrc

hrs_sx_tbl <- hrs_sx %>%
  mutate(Count = number(Count, big.mark = ",", accuracy = 2),
         Percent = percent(Percent, accuracy = 0.01))

hrs_rc <- hrs_rc %>%
  select(-Percent) %>%
  ungroup() %>%
  group_by(Project, Race) %>%
  summarize(Count = sum(Count)) %>%
  ungroup() %>%
  arrange(Project, desc(Count))

totals <- hrs_rc %>%
  group_by(Project) %>%
  summarize(Total = sum(Count))
  
totals <- totals$Total

n_tots <- c(rep(x = totals[1], times = 5),
            rep(x = totals[2], times = 5),
            rep(x = totals[3], times = 4),
            rep(x = totals[4], times = 5))

hrs_rc$Total <- n_tots

hrs_rc <- hrs_rc %>%
  ungroup() %>%
  mutate(Percent = Count / Total) %>%
  select(-Total)

hrs_rc_viz <- hrs_rc

hrs_rc_tbl <- hrs_rc %>%
  mutate(Count = number(Count, big.mark = ","),
         Percent = percent(Percent, accuracy = 0.01))

hrs_sxrc_tbl <- hrs_sxrc %>%
  mutate(Count = number(Count, big.mark = ",", accuracy = 2),
         Percent = percent(Percent, accuracy = 0.01)) %>%
  filter(!is.na(Gender))

```

</center>

<br>

<center>

**Table 10: Workforce Hourage Distribution by Gender & Project**

```{r hrs_by_sex_project, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

hrs_sx_tbl <- hrs_sx_tbl %>% select(-Project)

kable(hrs_sx_tbl) %>%
  kable_styling(bootstrap_options = c("striped", 
                                      "hover", 
                                      "responsive"),
                font_size = 14,
                full_width = TRUE) %>%
  group_rows(group_label = "Exposition Center", start_row = 1, end_row = 2) %>%
  group_rows(group_label = "Hancock International", start_row = 3, end_row = 4) %>%
  group_rows(group_label = "Highway I-690", start_row = 5, end_row = 6) %>%
  group_rows(group_label = "Lakeview Amphitheater", start_row = 7, end_row = 8)

```

</center>

<br>

<center>

**Image 13: Hourage Distribution by Gender & Projects**

```{r hrs_sx_viz_dist, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(hrs_sx_viz, aes(x = Project, y = Percent, fill = reorder(Gender, Percent))) +
  coord_flip() +
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent) +
  theme(legend.title = element_text("Gender")) +
  labs(fill = "Gender")

```

</center>

<br>

<center>

**Image 14: Hourage Totals by Gender & Project**

```{r hrs_sx_viz_count, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(hrs_sx_viz, aes(x = reorder(Project, Count), y = Count, fill = Gender)) +
  coord_flip() +
  geom_bar(stat = "identity", position = "dodge") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::number_format(big.mark = ",")) +
  xlab("Project")

```

</center>

<br>

## Hourage by Race & Project

<br>

<center>

**Table 11: Workforce Hourage Distribution by Sex & Project**

```{r hrs_by_rc_project, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

hrs_rc_tbl <- hrs_rc_tbl %>% select(-Project)

kable(hrs_rc_tbl) %>%
  kable_styling(bootstrap_options = c("striped", 
                                      "hover", 
                                      "responsive"),
                font_size = 14,
                full_width = TRUE) %>%
  group_rows(group_label = "Exposition Center", start_row = 1, end_row = 5) %>%
  group_rows(group_label = "Hancock International", start_row = 6, end_row = 10) %>%
  group_rows(group_label = "Highway I-690", start_row = 11, end_row = 14) %>%
  group_rows(group_label = "Lakeview Amphitheater", start_row = 15, end_row = 19)

```

</center>

<br>

<center>

**Image 14: Race Distribution for All Projects**

```{r hrs_rc_viz_dist, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(hrs_rc_viz, aes(x = Project, y = Percent, fill = reorder(Race, Percent))) +
  coord_flip() +
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent) +
  theme(legend.title = element_text("Gender")) +
  labs(fill = "Race") +
  xlab("Hours (%)")

```

</center>

<br>

<center>

**Image 15: Race Totals by Project**

```{r hrs_rc_viz_count, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(hrs_rc_viz, aes(x = reorder(Project, Count), y = Count, fill = Race)) +
  coord_flip() +
  geom_bar(stat = "identity", position = "dodge") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::number_format(big.mark = ",")) +
  xlab("Project") +
  ylab("Total Hours")

```

</center>

<br>

## Hourage by Gender, Race, Project

```{r hrs_sxrc_project, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

hrs_sxrc <- all_hours_sxrc %>%
  rename("Gender" = sex, "Race" = race, 
         "Count" = count, "Total" = total, 
         "Percent" = percent, "Project" = project) %>%
  select(-Total) %>%
  arrange(Project, desc(Count)) %>%
  filter(!is.na(Race),
         Count != 0) %>%
  as_data_frame()

hrs_sxrc_viz <- hrs_sxrc

hrs_sxrc_tbl <- hrs_sxrc %>% 
  mutate(Count = number(Count, big.mark = ",", accuracy = 2),
         Percent = percent(Percent, accuracy = 0.01)) %>%
  as_data_frame()

hrs_sxrc_tbl <- as.data.frame(hrs_sxrc_tbl)

file <- "~/Projects/REIS/Master/hrs_sxrc.rds"

save(hrs_sxrc_tbl, file = file)

load(file)

```

<br>

<center>

**Table 12: Workforce Hourage Distribution by Sex, Race, & Project**

```{r hrs_sxrc_proj_tbl, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

load(file)

hrs_sxrc_tbl <- hrs_sxrc_tbl %>% select(-Project)

kable(hrs_sxrc_tbl) %>%
  kable_styling(bootstrap_options = c("striped"),
                font_size = 14,
                full_width = TRUE) %>%
  group_rows(group_label = "Exposition Center", start_row = 1, end_row = 8) %>%
  group_rows(group_label = "Hancock International", start_row = 9, end_row = 13) %>%
  group_rows(group_label = "Highway I-690", start_row = 14, end_row = 19) %>%
  group_rows(group_label = "Lakeview Amphitheater", start_row = 20, end_row = 27)

```

</center>

<br>

<center>

**Image 16: Workforce Hourage Distribution by Sex, Race, & Project**

```{r hrs_sxrc_viz_dist, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(hrs_sxrc_viz, aes(x = reorder(Gender, Count), y = Percent, fill = reorder(Race, Percent))) +
  coord_flip() +
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent) +
  theme(legend.title = element_text("Gender")) +
  labs(fill = "Race") +
  xlab("") +
  ylab("Hours (%)") +
  facet_grid(Project ~ .)

```

</center>

<br>

<center>

**Image 17: Workforce Hourage Count by Sex, Race, & Project**

```{r hrs_sxrc_viz_count, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(hrs_sxrc_viz, aes(x = reorder(Gender, Count), y = Count, fill = Race)) +
  coord_flip() +
  geom_bar(stat = "identity", position = "dodge") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::number_format(big.mark = ",")) +
  xlab("") +
  ylab("Total Hours") +
  facet_grid(Project ~ .)

```

</center>

<br>

# Workforce Gross Wages 

```{r grs_sx_wf_tbl, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

gross_sex <- all_gross_sex %>%
  group_by(sex) %>%
  summarize(count = sum(count)) %>%
  as_data_frame() %>%
  arrange(desc(count)) %>%
  rename("Gender" = sex, "Count" = count) %>%
  mutate(Total = sum(Count),
         Percent = Count / Total)

gross_sex_viz <- gross_sex

gross_sex_tbl <- gross_sex %>%
  mutate(Percent = percent(Percent, accuracy = 0.01),
         Count = dollar(Count, big.mark = ",", accuracy = 2)) %>%
  select(-Total)

```

<br>

## Gross Wages Overview

<br>

<center>

**Table 13: Gross Wage Distribution by Gender**

```{r grs_sx_wf_tbl2, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

kable(gross_sex_tbl) %>%
  kable_styling(bootstrap_options = c("striped", 
                                      "hover", 
                                      "responsive"),
                font_size = 14,
                full_width = TRUE)

```

</center>

<br>

<center>

**Image 18: Gross Wage Distribution by Gender**

```{r gross_sex_viz, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(gross_sex_viz, aes(x = Gender, y = Percent)) +
  coord_flip() +
  geom_bar(stat = "identity", fill = "skyblue") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent)

```

</center>

<br>

<center>

**Table 14: Gross Wage Distribution by Race**

```{r grs_rc_wf_tbl, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

gross_race <- all_gross_race %>%
  group_by(race) %>%
  summarize(count = sum(count)) %>%
  as_data_frame() %>%
  arrange(desc(count)) %>%
  rename("Race" = race, "Count" = count) %>%
  mutate(Total = sum(Count),
         Percent = Count / Total)

gross_race_viz <- gross_race

gross_race_tbl <- gross_race %>%
  mutate(Percent = percent(Percent, accuracy = 0.01),
         Count = dollar(Count, big.mark = ",", accuracy = 2)) %>%
  select(-Total)

kable(gross_race_tbl) %>%
  kable_styling(bootstrap_options = c("striped", 
                                      "hover", 
                                      "responsive"),
                font_size = 14,
                full_width = TRUE)

```

</center>

<br>

<center>

**Image 19: Gross Wage Distribution by Race**

```{r grs_rc_wf_viz, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(gross_race_viz, aes(x = reorder(Race, Count), y = Percent)) +
  coord_flip() +
  geom_bar(stat = "identity", fill = "skyblue") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent) +
  xlab("") +
  ylab("Total Gross (%)")

```

</center>

<br>

<center>

**Table 15: Gross Wage by Gender & Race**

```{r grs_sxrc_wf_tbl, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

gross_sxrc <- all_gross_sxrc %>%
  group_by(sex, race) %>%
  summarize(count = sum(count)) %>%
  as_data_frame() %>%
  rename("Gender" = sex, "Race" = race, "Count" = count) %>%
  mutate(Total = sum(Count),
         Percent = Count / Total) %>%
  arrange(desc(Percent))

gross_sxrc_viz <- gross_sxrc

gross_sxrc_tbl <- gross_sxrc %>%
  mutate(Percent = percent(Percent, accuracy = 0.01),
         Count = dollar(Count, big.mark = ",", accuracy = 2)) %>%
  select(-Total)

kable(gross_sxrc_tbl) %>%
  kable_styling(bootstrap_options = c("striped", 
                                      "hover", 
                                      "responsive"),
                font_size = 14,
                full_width = TRUE)

```

</center>

<br>

<center>

**Image 20: Gross Wage Distribution by Gender & Race**

```{r sxrc_grs_dist_viz, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(gross_sxrc_viz, aes(x = reorder(Race, Percent), y = Percent, fill = Gender)) +
  coord_flip() +
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent) +
  xlab("Race")

```

</center>

<br>

## Gross by Gender & Project

```{r sxrc_gross_all_setup, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

gp_sex <- all_gross_sex %>% 
  rename("Gender" = sex, "Count" = count, "Total" = total, "Percent" = percent, "Project" = project) %>%
  select(-Total) %>%
  arrange(Project, desc(Percent))

gp_sex_viz <- gp_sex
gp_sex_tbl <- gp_sex %>%
  mutate(Percent = percent(Percent, accuracy = 0.01),
         Count = dollar(Count, big.mark = ",", accuracy = 2))
  

gp_race <- all_gross_race %>% 
  rename("Race" = race, "Count" = count, "Total" = total, "Percent" = percent, "Project" = project) %>%
  select(-Total) %>%
  arrange(Project, desc(Percent))

gp_race_viz <- gp_race
gp_race_tbl <- gp_race %>%
  mutate(Percent = percent(Percent, accuracy = 0.01),
         Count = dollar(Count, big.mark = ",", accuracy = 2))


gp_sxrc_all <- all_gross_sxrc %>% 
  rename("Gender" = sex, "Race" = race, "Count" = count, "Total" = total, "Percent" = percent, "Project" = project) %>%
  select(-Total) %>%
  arrange(Project, desc(Percent))

gp_sxrc_viz <- gp_sxrc_all
gp_sxrc_tbl <- gp_sxrc_all %>%
  mutate(Percent = percent(Percent, accuracy = 0.01),
         Count = dollar(Count, big.mark = ",", accuracy = 2))

```

</center>

<br>

<center>

**Table 16: Gross Wage Distribution by Gender & Project**

```{r grs_by_sex_project, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

gp_sex_tbl <- gp_sex_tbl %>% select(-Project)

kable(gp_sex_tbl) %>%
  kable_styling(bootstrap_options = c("striped", 
                                      "hover", 
                                      "responsive"),
                font_size = 14,
                full_width = TRUE) %>%
  group_rows(group_label = "Exposition Center", start_row = 1, end_row = 2) %>%
  group_rows(group_label = "Hancock International", start_row = 3, end_row = 3) %>%
  group_rows(group_label = "Highway I-690", start_row = 4, end_row = 5) %>%
  group_rows(group_label = "Lakeview Amphitheater", start_row = 6, end_row = 7)

```

</center>

<br>

<center>

**Image 21: Gross Wage Distribution by Gender & Projects**

```{r grs_sx_viz_dist, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(gp_sex_viz, aes(x = Project, y = Percent, fill = reorder(Gender, Percent))) +
  coord_flip() +
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent) +
  theme(legend.title = element_text("Gender")) +
  labs(fill = "Gender")

```

</center>

<br>

<center>

**Image 22: Gross Wage Totals by Gender & Project**

```{r grs_sx_viz_count, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(gp_sex_viz, aes(x = reorder(Project, Count), y = Count, fill = Gender)) +
  coord_flip() +
  geom_bar(stat = "identity", position = "dodge") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::number_format(big.mark = ",", prefix = "$")) +
  ylab("Gross Wages") +
  xlab("")

```

</center>

<br>

## Wages by Race & Project

<br>

<center>

**Table 17: Gross Wage Distribution by Sex & Project**

```{r grs_by_rc_project, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

gp_race_tbl <- gp_race_tbl %>% select(-Project)

kable(gp_race_tbl) %>%
  kable_styling(bootstrap_options = c("striped", 
                                      "hover", 
                                      "responsive"),
                font_size = 14,
                full_width = TRUE) %>%
  group_rows(group_label = "Exposition Center", start_row = 1, end_row = 5) %>%
  group_rows(group_label = "Hancock International", start_row = 6, end_row = 10) %>%
  group_rows(group_label = "Highway I-690", start_row = 11, end_row = 14) %>%
  group_rows(group_label = "Lakeview Amphitheater", start_row = 15, end_row = 19)

```

</center>

<br>

<center>

**Image 23: Gross Wage Distribution for All Projects**

```{r grs_rc_viz_dist, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(gp_race_viz, aes(x = Project, y = Percent, fill = reorder(Race, Percent))) +
  coord_flip() +
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent) +
  theme(legend.title = element_text("Gender")) +
  labs(fill = "Race") +
  xlab("")

```

</center>

<br>

<center>

**Image 24: Gross Wage Totals by Race & Project**

```{r grs_rc_viz_count, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(gp_race_viz, aes(x = reorder(Project, Count), y = Count, fill = Race)) +
  coord_flip() +
  geom_bar(stat = "identity", position = "dodge") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::number_format(big.mark = ",", prefix = "$")) +
  xlab("") +
  ylab("Total Gross")

```

</center>

<br>

## Gross by Gender, Race, Project

```{r grs_sxrc_proj_tbl_2, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

url <- "https://raw.githubusercontent.com/jamisoncrawford/reis/master/Datasets/all_gross_sxrc.csv"
gp_sxrc <- read_csv(url)

gp_sxrc <- gp_sxrc %>% 
  rename("Gender" = sex,
         "Race" = race,
         "Count" = count,
         "Total" = total,
         "Percent" = percent,
         "Project" = project) %>%
  select(-Total) %>%
  as_tibble() %>%
  arrange(Project, desc(Count))

gp_sxrc_viz <- gp_sxrc

gp_sxrc_tbl <- gp_sxrc %>%
  mutate(Count = number(Count, big.mark = ",", accuracy = 2),
         Percent = percent(Percent, accuracy = 0.01))
  
```

<br>

<center>

**Table 18: Gross Wage Distribution by Sex, Race, & Project**

```{r grs_sxrc_proj_tbl_3, message=FALSE, warning=FALSE, echo=FALSE, cache=TRUE}

gp_sxrc_tbl <- gp_sxrc_tbl %>% select(-Project)

kable(gp_sxrc_tbl) %>%
  kable_styling(bootstrap_options = c("striped"),
                font_size = 14,
                full_width = TRUE) %>%
  group_rows(group_label = "Exposition Center", start_row = 1, end_row = 8) %>%
  group_rows(group_label = "Hancock International", start_row = 9, end_row = 13) %>%
  group_rows(group_label = "Highway I-690", start_row = 14, end_row = 19) %>%
  group_rows(group_label = "Lakeview Amphitheater", start_row = 20, end_row = 27)

```

</center>

<br>

<center>

**Image 25: Gross Wage Distribution by Sex, Race, & Project**

```{r grs_sxrc_viz_dist, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(gp_sxrc_viz, aes(x = reorder(Gender, Count), y = Percent, fill = reorder(Race, Percent))) +
  coord_flip() +
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::percent) +
  theme(legend.title = element_text("Gender")) +
  labs(fill = "Race") +
  xlab("") +
  ylab("Gross Pay (%)") +
  facet_grid(Project ~ .)

```

</center>

<br>

<center>

**Image 26: Gross Wage Total by Sex, Race, & Project**

```{r grs_sxrc_viz_count, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7, cache=TRUE}

ggplot(gp_sxrc_viz, aes(x = reorder(Gender, Count), y = Count, fill = Race)) +
  coord_flip() +
  geom_bar(stat = "identity", position = "dodge") +
  theme_classic() +
  theme(text = element_text(size = 18), 
        axis.text = element_text(size = 16),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(labels = scales::number_format(big.mark = ",", prefix = "$")) +
  xlab("") +
  ylab("Total Gross") +
  facet_grid(Project ~ .)

```

</center>

<br>
